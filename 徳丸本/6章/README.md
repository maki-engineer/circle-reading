# 6章
## 6.1 (525p) 文字コードとセキュリティの概要
### 文字コードとは
文字コードは次の2つの概念を合わせたもの。
- 文字集合 (6.2で説明)
- 文字エンコーディング (6.3で説明)

Webアプリケーション上で文字コードを指定する箇所はたくさんある。
- 入力の場面
  - ブラウザ → HTTPリクエスト
- 処理の場面
  - アプリケーションの処理
  - スクリプトファイル
- 出力の場面
  - HTTPレスポンス → HTMLブラウザ表示
  - DB (SQL)
  - ファイル
  - メール
  - 外部コマンド


## 6.2 (526p) 文字集合

## 6.3 (529p) 文字エンコーディング

## 6.4 (540p) 文字コードによる脆弱性の発生要因まとめ
### 文字エンコーディングとして不正なバイト列による脆弱性

### 文字エンコーディングの扱いの不備による脆弱性

### 文字集合の変更に起因する脆弱性
例えばWindowsのコマンドプロンプト上やVS Code上で「￥」と打とうとすると、「\」に変換されるが、これが文字集合の変更に起因する脆弱性。
この脆弱性が原因で新たに発生してしまう脆弱性としては、4.4章で紹介したJVN#59748723 (http://jvn.jp/jp/JVN59748723/index.html) がある。

## 6.5 (541p) 文字コードを正しく扱うために
文字コードを正しく扱うためのポイントは4つ
- アプリケーション全体を通して文字集合を統一する
- 入力時に不正な文字エンコーディングをエラーにする
- 処理の中で文字エンコーディングを正しく扱う
- 出力時に文字エンコーディングを正しく指定する

### アプリケーション全体を通して文字集合を統一する

### 入力時に不正な文字エンコーディングをエラーにする

### 処理の中で文字エンコーディングを正しく扱う

### 出力時に文字エンコーディングを正しく指定する

### その他の対策

## 6.6 (546p) まとめ
Webアプリケーションを開発している際に、文字化けが起こるのはあるあるの1つだが、文字化けが起こるということは、文字コードの適切な設定や処理ができていないことを意味するため、それが脆弱性と繋がる。<br><br>そのため、文字コードの扱いに起因する脆弱性問題の取り組みとして、まずは文字化けをなくす対策をするのがおすすめ。<br>具体的には
- 不正な文字エンコーディングではエラーになるか代替文字 (U+FFFD) に変換されること
- 「表」や「ソ」、「能」などが正しく登録・表示されること
- 「尾骶骨テスト」と「つちよしテスト」をクリアすること
  - 尾骶骨テストとつちよしテストとは
    - 文字通りWeb上に「尾骶骨」や「𠮷 (つちよし) 」と正しく表示されるかテストする方法。<br>「骶」と「𠮷」という文字はShift_JIS、EUC-JPでは表現できない文字のため、Unicodeに変換することができているか簡単にテストすることができる。

などが挙げられる

#### 文字コードの脆弱性を利用した攻撃の代表であるNimbaワームについて

### 対策のまとめ
- アプリケーション全体を通して文字集合をUnicodeで統一する
- 入力時に不正な文字エンコーディングをエラーにする
- 処理の中で文字エンコーディングを正しく扱う
- 出力時に文字エンコーディングを正しく指定する

### 参考文献
- 『プログラマのための文字コード技術入門』 (https://amzn.to/3Lugpeb)
- 『電脳社会の日本語』 (https://amzn.to/3Apv1VI)